
	
	
		
List of Figures
List of Tables
SummaryAmong its many other functions, the Federal Aviation Administration's En Route Automation Modernization (ERAM) provides external systems with real-time air traffic data for flights in enroute airspace in the National Airspace System.It replaced the En Route Host computer and backup system used at 20 FAA Air Route Traffic Control Centers (Centers) nationwide.Among the new features of ERAM, its output data stream of flight plan and track data includes a unique identifier for a flight originating in any one of the 20 ERAM Centers.The unique identifier, called the Global Unique Flight Identifier (GUFI), is persistent across all the Centers that track the flight.However, certain factors make it difficult to correlate data using the GUFI.First, the value of the GUFI is only unique within a time window of seven days.Second, the GUFI is attached only to flight-plan related data messages.Finally, track positions reported by ERAM do not reference the GUFI.In order to correlate historical as well as real time flight-plan and positionrelated ERAM data, an efficient, heuristic approach was developed, and a prototype was developed.The approach showed that the processing speed, through parallel processing, is sufficient to correlate ERAM data in real-time.As described in this paper, when there are multiple track positions reported from multiple Centers within a few seconds, each position is assigned with a weighted score to indicate the quality of the position relative to its last know position.The weighted score can be used to eliminate potentially duplicate track positions.The approach is database-agnostic, and can be implemented in a Big Data system such as an Apache Hadoop system, as well as in traditional database systems.
IntroductionThere are multiple, disparate FAA systems that act as data sources to provide flight information and surveillance data such as track positions.Each data source has a specific reporting frequency for track positions over its geographic area.Example data sources include the System Wide Information Management's (SWIM) Terminal Data Distribution System (STDDS) for data on or near airport surface, radar data from a Terminal Radar Approach Control (TRACON), surveillance data from En Route Automation Modernization (ERAM) at an Air Route Traffic Control Center (Center), and Airline Situation Display to Industry (ASDI) and Traffic Flow Management Data (TFMData) that cover the National Airspace System (NAS).For each data source, a flight can be uniquely identified, and its track positions be associated, during a time window.Depending on a data source, the identifier has a unique value within a specific time window.The time window varies from a few minutes to a week.In order to get a complete picture of a flight from its departure to its arrival, data from all these disparate data sources must be correlated.Correlating is the process of determining which piece of information applies to which flight.But because the track positions for a flight can be reported from multiple data sources, and each source has its own computations, an aircraft can have multiple, differing track positions reported at the same time, or within a few seconds of each other.This is one of the many challenges in correlating flight data from disparate data sources.In order to provide a single view of all flight data over a long period, those flight data need to be correlated and stored in a Data Warehouse such as NASA's Sherlock [1].When such a correlating process can be performed within a fraction of a second, it can also be adopted for a real-time system that subscribes to live flight data.Correlated flight data are currently available from a few commercial vendors.These products, such as ITT Exelis, Passur, and ATAC's Performance Data Analysis and Reporting System (PDARS), all use proprietary algorithms to correlate flight data from multiple data sources.This document describes one approach to correlating ERAM data from twenty Centers so that all flight information is uniquely identified across time, track positions are properly associated with a flight, and the quality of each track position is assessed.This document also describes a prototype implementing this approach.Additional derived data such as calibrated airspeed, departure fix, and arrival fix, and fix crossing times could be computed on the correlated data.Once the correlated data and derived data are stored in a Data Warehouse, an ATM researcher can readily perform Big Data analyses on them.As a result, a researcher will no longer have to restrict their analyses to one Center or correlate the flight data across the disparate data sources themselves.The Host Air Traffic Management (ATM) Data Distribution System (HADDS) Application Interface provides external customers such as NASA with ERAM data.It can provide this data in a variety of messages sets sent in several binary stream formats.For a given combination of binary stream format and message type, a set of fields is specified.Evaluations were made on the data from various binary stream formats, namely, CT07, CT08, and NA02.These formats were created by FAA for its Offline Application Registration Service (OARS).For each format, the specifications were entered into a set of worksheets in an Excel workbook file.NA02 was determined to have the most message types and fields.The work described in this document is based on the NA02 format created for NASA by FAA.
ObjectivesThis section describes the process and rules that were implemented to correlate ERAM data from twenty Centers.1.Each ERAM message is processed, and reformatted from the NA02 binary stream format into an XML format.
2.No ERAM XML message is discarded.It is up to an ATM researcher to determine which ERAM messages are to be analyzed.3. Each ERAM XML message is assigned a universally unique identifier (UUID) called nasaMsgId.Unlike a simple sequence number or a time-based number, when a UUID is generated from multiple systems, they are distinct and can be consolidated into a single system later on.There are multiple algorithms for generating a UUID [2]; the one used for this effort is described later.4. If an ERAM XML message contains flight information or track positions, that message is associated with either a new or an existing nasaGufi.nasaGufi is a universally unique identifier that represents a flight.ERAM's GUFI is unique only within a rolling time window of seven days.Relying on ERAM's GUFI is not possible if an historical analysis spans more than seven days.5. When an ERAM XML message is assigned a nasaGufi, a weighted score, nasaGufiScore, is calculated to determine the accuracy of the assignment.When a new nasaGufi is assigned to an ERAM XML message, this initial nasaGufiScore should be 1.The lowest nasaGufiScore is 0.5.6.When an ERAM XML message contains a track position for a flight, a weighted score, nasaMsgIdScore, is calculated to determine the quality of the track position when it is compared with the last known reported track position of the same flight.This is valuable information when multiple ERAM Centers report the track position of the same flight at the same time, or within a few seconds.A value between 0 and less than 0.5 indicates a low quality position messages.A value of 0.5 to 1 indicates a high quality.All non-trackposition ERAM XML messages have a value of 1.
ERAM MessagesIn the NA02 binary stream format, 35 message types have been identified in the actual data.Additional message types were described in the OARS NA02 documentation, but they were not reported in the actual data during analysis.See Table In order to make ERAM data more accessible, the binary data were formatted into XML for this work.The XML element names closely resemble those of the "Simple Schema" from the System Wide Information Management (SWIM) Flight Data Publication Service (SFDPS) [3].See Appendix A: Sample ERAM Messages in XML Format for each message type.Each ERAM message is identified by a message type (msgType), an originating facility (msgFacility), and a timestamp when the message is received at NASA (msgRcvTimeEpoch).The originating facility is the Center (e.g., ZNY or ZFW).
Fields Used to Correlate ERAM From Twenty CentersAmong flight related ERAM messages, a specific list of fields is extracted for the correlation process.See Table 2.The list of flight-related ERAM messages is indicated by a grey background.For each message type, M indicates that a field is mandatory for successful correlation; O indicates that a field is optional; M* indicates that a field is mandatory when a Center is ERAM operational; and M+ indicates that a field is derived from another mandatory field.--2 computerId_02d--2 sspId_167a--2 beaconCode_04a--2 eramGufi_316a--2 AH M M M M M M* O M O M M M M+ M+ AI M M BA M M M M M M* M M* M M M M M* M M* CK0 M M M CL M M M M M M* M M DH M M M M M M* M M M M M ET M M M M M M* FH M M M M M M* O M* M O M M M M+ M+ FPI M M M M M* O M* M O O O M M M M+ M+ GH M M M HA M M M HF M M M M M M* HH M M M M M M* HI M M HP M M M M M M* M M HR M M M HS M M M HT M M M M M M* HV M M M M M M* M M HX M M M M M M* HZ M M M M M M M M IH M M M M M M* M M M M M* LH M M M M M M* NL M M M M M M* OH M M M M M M* PH M M M M M M* PT M M M M M M* RE M M M M M M* M M* M M RH M M M M M M* RI M M--2 computerId_02d--2 sspId_167a--2 beaconCode_04a--2 eramGufi_316a--2 S1 M M SH M M M SI M M TH M M M M M M* M M M M M UB M M M
Available Fields From a Center When ERAM Is OperationalIn ERAM, message types that are flight related have two mandatory fields, flightId_02a and computerId_02d.flightId_02a contains usually the callsign of a flight, or the tail number of an aircraft.computerId_02d is a system generated 4-digit number from a Center.computerId_02d is based on the legacy Host Computer System that ERAM replaced.At any given moment in time, a flight can be uniquely identified by computerId_02d from within a Center.When a flight is completed or cancelled within a Center, the value in computerId_02d can be reused for another flight immediately.When ERAM is operational at a Center, all flight related messages from that Center report the field sspId_167a (Site Specific Plan ID).Like computerId_02d, sspId_167a is also a system generated 4-digit number from a Center.The only exception is the HZ (ARTS TZ Information) message.A HZ message reports the track position of a flight from a TRACON source, and this message does not have the field sspId_167a.Only computerId_02d is referenced in a HZ message.And like computerId_02d, when a flight is completed or cancelled within a Center, the value in sspId_167a can also be reused for another flight immediately.The field eramGufi_316a is a unique flight plan identifier (e.g., KJ84748500).It is reported only in four message types: BA, FH, FPI, and RE, and only when ERAM is operational at a Center.As a flight traverses multiple Centers, the value of eramGufi_316a for the flight is persistent in each of the traversed Centers.However, the value of eramGufi_316a is only unique within a rolling window of seven days across all Centers.Both computerId_02d and sspId_167a are small, system-generated numbers of four digits.Therefore the numbers from a Center can be short-lived.They can be reused as soon as the flights with which they are associated are completed or cancelled within that Center.For example, sspId_167a with a value of 288 can be assigned to track different flights at the ZNY Center within a period of 24 hours.Track position messages are all associated with either computerId_02d, or computerId_02d and sspId_167a combined, but not eramGufi_316a.Therefore, in order to find the flight plan of a given track position message at a specific moment in time, one needs to find the most recent past flight plan message that has a matching computerId_02d or sspId_167a.As described later in this document, when flight data and track position messages are correlated, unlike with computerId_02d, sspId_167a, or eramGufi_316a, the unique value assigned to a nasaGufi does not have a time limit.As of October 4th, 2014, the ZNY and ZTL Centers were not ERAM operational.As of March 27th, 2015, all 20 Centers were ERAM operational.
Flight Data ScenariosDuring the development and testing of the flight data correlation approach described in this document, challenging correlation scenarios from the actual ERAM data were analyzed and assembled as test cases.Here are the scenarios:
Multiple Flight Plans Can Be Proposed Prior To Departure Or En RouteMultiple flight plans can be proposed for a single flight prior to departure.Multiple flight plans can also be proposed for a single en-route flight prior to it entering the airspace of a Center.Among the proposed flight plans, at most one will be accepted.Which one this is, is not known until a track position record is associated with the accepted flight plan.Some of the proposed flight plans may get cancelled, or they may expire automatically.A CL message is reported for the former case, but there are no reported messages for the latter case.
Using Same Callsign to Propose a New Flight Plan Upon ArrivalWhile an aircraft is en route to its destination with a flight plan, FP1, a new flight plan, FP2, can be proposed for the next flight of the aircraft before the completion of the FP1.Both en route and proposed flight plans use the same callsign.
Diverted Flight Has a New Destination in Its Amended Flight PlanWhen a flight is diverted to a new destination, an AH message is sent with an updated flight plan.The new arrival airport may be the original departure airport.
Flight Plan of an En Route Flight Is Canceled Before Entering a New CenterWhen a flight departs from one Center, C1, and enters or passes through another Center, C2, it normally receives a new flight plan before it enters into the airspace of C2, followed by a cancellation of its flight plan in C1.In reality, there are cases in which the cancellation precedes the proposed plan.In order words, the chronological order of these two messages may reverse.
No Messages When Flight Path Over Areas Not Covered by ERAMWhen a flight flies from KBOS (Boston) to KSEA (Seattle) via the Canadian airspace, there are no ERAM messages while it is in the Canadian airspace.When the flight flies from the Canadian airspace into ZSE Center, a new eramGufi_316a is assigned.Similar scenarios may also apply to messages from the same Center.For example, in the northern part the ZOB Center, there is an area that is a part of the Canadian airspace.A flight may start in the ZOB Center, go through the CZY Canadian air traffic control center, and enter back into the ZOB Center.When the flights enters back into the ZOB Center, a new eramGufi_316a is assigned.Therefore the original GUFI cannot be used for correlation of the flight.
Flight Path Over Atlantic OceanFlight paths in the Atlantic Ocean, especially near Bermuda International Airport (TXKF) have messages sent from ZNY Center.When such a flight has a long gap in track position messages reported over the Atlantic Ocean then becomes tracked again, the newly assigned eramGufi_316a is different from the original.As a result, it is possible to have a flight having two different eramGufi_316a values even though the flight never leaves ZNY Center.Thus the eramGufi_316a cannot be used solely for correlating flight data even within one Center.
Multiple Aircraft From Different Departures Sharing a CallsignSome airlines schedule connecting flights using the same flight number, or callsign.When an inbound flight arrives late, the outbound connecting flight may get assigned to a different aircraft, using the same callsign as the inbound one.As a result, two flights maybe active within one Center at the same time.While each flight has the same flightId_02a, each flight has a different set of computerId_02d, sspId_167a, eramGufi_316a, departure, and beaconCode_04a.
Multiple Aircraft Sharing a Callsign Split Up While En RouteWhen two aircraft, AC1 and AC2, are flying in formation (e.g. military aircraft), there may be one flight plan, FP1, for both aircraft.When they no longer share the same flight plan, an IH message is sent to describe the flight plan, FP2, for AC2.FP1 is still valid for AC1.
Multiple Aircraft Merge to Share a CallsignMultiple aircraft can merge to share a callsign.For example, when a military aircraft joins up with an aerial refueling aircraft.
Callsign Changed After DepartureThe callsign of a flight can change after its departure.For example, an incorrect callsign might have been used when a flight plan was proposed, and the callsign was not corrected until after its departure.An IH message is sent to describe the new callsign.
Beacon Code Changed After DepartureOne common reason for an en route flight to change its beacon code before entering the airspace of a Center is to avoid conflict with another flight using the same beacon code.A BA message is usually sent to note the new beacon code.This BA message is usually followed by a FH message for the en route flight.
Departure Fix Changed in Proposed Flight Plan When Entering a New CenterWhen an en route flight files a proposed flight plan before entering the airspace of a Center, the en route flight may not use the original departure fix from its original flight plan as its departure point.Instead, the en route flight may use a Fix Radial Distance (FRD) along its flight path as its departure fix instead.The arrival fix of the proposed flight does not change.
Track Messages May Not Be Received In Chronological OrderIn most cases, track positions and the time of those reported positions are sent and received at NASA in chronological order.But sometimes they are not.Perhaps because of a system delay, a track position message just received may reference a position and time earlier than the previous track position message for the same aircraft.This problem is more pronounced when an aircraft is in the vicinity of multiple Center boundaries.Track messages from multiple Centers are reported, but some of the messages may not arrive in the order of the actual time of those track positions.
Multiple Tracks for a Single Flight Reported From Multiple CentersBecause there are overlaps of radar coverage along Center boundaries, multiple track position messages of the same aircraft maybe reported at the same time from two or more Centers near the Center boundaries.
Track Position Messages May Not Be Reported Every 12 SecondsThere are many reasons that track positions may not be updated every 12 seconds or less.One common reason is the limited coverage by ground-based radar.For a coast-to-coast flight over the Canadian airspace, the gap in track position updates can be over four hours.
Heuristic Approach to Correlating Flight Data
General Correlation ProcessBecause a flight may cross multiple Centers, there may be multiple flight-state-per-Center records associated with one nasaGufi.Flight-state-per-Center is described in Section 4.2.When a flight-related message is reported from a Center, the appropriate flight-state-per-Center needs to be correlated.This is a general two-step process as described in the following:
Finding an Existing nasaGufiThe search method for an existing flight-state-per-Center record is dependent on the category of a flight-related message.As described later in this document, there are three categories of flight-related messages: Route, Track Position, and Generic (see Sections 4.4, 4.5, and 4.6 respectively).The general searching method starts by querying all existing flight-state-per-Center records that have the same flightId_02a from the message.The query imposes a lookback time limit.For example, only flight-state-per-Center records that were last reported within the last five hours from the message's timestamp are queried.Multiple evaluations are made among the fields from the message and the fields in each of the queried flight-state-per-Center records.The evaluations range from simple text matching to a complex if-then-else condition.Each evaluation results in a raw score.A raw score ranges from a positive numeric value for a positive match to a negative value for a mismatch.A simple summation on all the computed raw scores gives the total weighted score on a given flight-state-per-Center record.When all flightstate-per-Center records have their total weighted scores computed, they are ranked.In general, the higher the total weighted score, the higher the likelihood that a match to an existing nasaGufi is found.When an existing nasaGufi is not found or if the total weighted score is negative, a new nasaGufi is created.
Updating a New Flight-State-Per-Center RecordIn the previous step, either an existing nasaGufi is found, or a new nasaGufi is assigned.By using the unique key flightId_02a, msgFacility, computerId_02d, and nasaGufi, the flight-stateper-Center record in the database should be updated accordingly.If the record in the database cannot be updated because it does not exist, a new flight-state-per-Center record is created.
Structure of Flight-State-Per-Center RecordA flight-related ERAM message is a piece of information that describes the state or an event of the flight at a specific moment in time.The state may contain information such as callsign, tail number, beacon code, flight plan, and track position.Whenever a flight has a change of state or an event, only related information is reported in order to keep the message short and concise for transmission.The complete set of flight information is not reported in a single message.The first step in correlating the ERAM flight data is to construct the state of each flight for each ERAM Center.This requires processing the messages in the exact chronological order they were received at NASA.Not all fields from the messages are required to correlate a flight.Table 3 shows the list of fields for correlating a flight across multiple Centers.Correlated flight records from multiple Centers are assigned to a unique identifier called nasaGufi.Fields with grey background are related to track position only.Center records should be stored in a database in order to allow concurrent access to the information.
When the Callsign of a Flight is ChangedAs described in Section 3.3.10,an IH message is reported when there is a callsign change for a single aircraft flight.An IH message may also be used to report an aircraft getting a new callsign while flying in formation with another aircraft (see Section 3.3.8).In the second scenario, the existing and new callsigns are both needed for associating two separate aircraft and their respective flight plans.Callsign is stored in the field flightId_02a, and flightId_02a is also a part of the unique key of each flight-state-per-Center record.In order to handle both scenarios, when a flight has a callsign changed from CS1 to CS2, the solution is to locate the flight-state-per-Center record of the CS1, copy all the state information from the located record to create a new record for CS2.Any subsequent updates of the state (e.g.flight plan) of CS2 would be performed on the newly created record.The flight-state-per-Center record of the CS1 would not be updated once an IH message is processed.
Weighted Scores to Calculate Route ScoreTo correlate a flight plan or flight plan amendment message (AH, FH, and FPI), a set of weighted scores is used to evaluate seven conditions of the message with existing flight-stateper-Center records having the same callsign in the database (see Section 4.1.1).The seven conditions are described in Table 4.There is one weighted score from each of the seven conditions.When a condition is met (or not met), a weighted score is assigned for that condition.Combining the weighted scores on each flight-state-per-Center candidate record yields the total combined score of each candidate record.Scored candidate records are ranked by the following criteria:1. Total combined score (the higher the better) 2. msgRcvTimeEpoch (the higher the better) 3. sourceId_00e (the higher the better)The first record returned with a positive total score has the matching nasaGufi.To calculate nasaGufiScore, the total score, and the difference between msgRcvTimeEpoch and the msgRcvTimeEpoch from the matching nasaGufi record is normalized to range between 0.5 and 1. nasaMsgId is system generated by using UUID.nasaMsgIdScore is always 1.
DepartureThe evaluation of departure requires more than a simple match of the departure from a flight-plan message and the departure from a flight-state-per-Center candidate record.As described in the scenario from Section 3.3.12,the original departure of a flight may not be present in a proposed flight plan when entering into a new Center.The evaluation also needs to work in the scenario when a diverted flight returns to its departure Center from an adjacent Center.This scenario requires the following fields:• proposedDepartureTime_2431 • departureTime_243n • coordStatus_07d1 • coordTime_07d2
Weighted Scores to Calculate Track ScoreTo correlate a track position message (FZ and TH) to a flight, a weighted score is used to evaluate the conditions of the message with existing flight-state-per-Center candidate records having the same callsign in the database (see Section 4.1.1).There are five mutually exclusive conditions as described in Table 5.Scored candidate records are ranked by the following criteria: 1. Assigned score (the higher the better) 2. msgRcvTimeEpoch (the higher the better) 3. timeOfTrackData_170a (the higher the better)The first record returned with a positive total score has the matching nasaGufi.To calculate nasaGufiScore, the total score, and the difference between msgRcvTimeEpoch and the msgRcvTimeEpoch from the matching nasaGufi record is normalized to range between 0.5 and 1. nasaMsgId is system generated by using UUID.Because track positions of an aircraft may be reported by multiple Centers at the same time, or within few seconds, the quality of each reported track position needs to be evaluated.After analyzing actual ERAM data near Center boundaries, it is concluded that it is not reliable to rely on the controlling Center of a flight to determine which track source should be used.Some flights have many track positions reported solely from non-controlling Centers for a few minutes or longer.Therefore, it is better to evaluate track position messages independent of whether they are originated from the controlling Centers.Evaluating whether a reported track position, P1, follows the flights actual trajectory requires the time, latitude, and longitude of P1, and its last reported position, P0, and the reported bearing from one of the two positions.Bearing is reported in each TH track position message.When the reported bearing does not deviate far from a derived bearing from P0 to P1, the quality of P1, nasaMsgIdScore, is good.nasaMsgIdScore is calculated as follows:Let position P0 be the last known position of the aircraft at time T0 from the database, and P1 be the position at time T1 from the message.The derived bearing from P0 to P1 is B1 derived .For a TH message, the bearing at P1, B1, is provided by the message.The rate of bearing difference during the time period from T0 to T1, ∆B rate, is:∆B rate = |B1 derived -B1| / |T1 -T0|B rateThreshold is the threshold of the rate of bearing difference.Analysis on the ERAM data showed that when B rateThreshold is 1 degree per second, the transition from one track position to another does not have a seesaw pattern.nasaMsgIdScore is based on ∆B rate .If ∆B rate < B rateThreshold , nasaMsgIdScore is normalized to range between 0.8 to 0.9 by using the value of ∆B rate .Otherwise, nasaMsgIdScore is normalized to range between 0.141 to 0.49.
Weighted Scores to Calculate Generic ScoreTo correlate any other flight-related message except flight plan and track position, a weighted score is used to evaluate five conditions of the message against existing flight-state-per-Center candidate records having the same callsign in the database (see Section 4.1.1).The five conditions are described in Table 6Table 4.There is one weighted score from each of the five conditions.Combining the weighted scores on each flight-state-per-Center candidate record yields the total combined score of each candidate record.Scored candidate records are ranked by the following criteria: 1.Total combined score (the higher the better) 2. msgRcvTimeEpoch (the higher the better) 3. sourceId_00e (the higher the better)The first record returned with a positive total score has the matching nasaGufi.nasaGufiScore is calculated by first adding the total score, and the difference between msgRcvTimeEpoch and the msgRcvTimeEpoch from the matching nasaGufi record.The result is normalized to a range between 0.5 and 1. nasaMsgId is system-generated using the UUID.nasaMsgIdScore is always 1.
Prototype ImplementationA software prototype for correlating ERAM flight data from twenty Centers was implemented.The prototype utilized the Pentaho Data Integration [4] (PDI) application tool and an Oracle database.The Pentaho Data Integration (PDI) application tool was used to read the ERAM XML files created and archived at NASA.An Oracle database was set up to store flight-state-per-Center records, as well as the complete messages with the four added NASA fields.The detailed logic for finding an existing nasaGufi, creating a new nasaGufi, the confidence of the nasaGufi assignment (nasaGufiScore), and evaluating the quality of a track position message (nasaMsgIdScore) were performed by an Oracle package procedure that was written in the Oracle procedure language PL/SQL.Depending on the message category (Route, Track-Position, or Generic), the appropriate Oracle package procedure is executed, and the appropriate flight-state-per-Center record is updated in the database (see Section 4).For the prototype, a look-back time limit is set to five hours to query the existing nasaGufi from the existing flight-state-per-Center records in the database (see Section 4.1.1).The five-hour limit is chosen because a normal flight departing from and arriving within the NAS may fly over Canadian airspace for up to about five hours.A longer look-back time limit could be used.Another alternative is to shorten the look-back time limit when flight data from the Canadian airspace is available (e.g., ASDI and TFMData).
Use of Oracle Database as Data StoreAn Oracle relational database was chosen to store and query flight-state-per-Center records.Other in-memory-only databases would likely be better to get faster performance.However, for the proof-of-concept prototype effort, a persistent Oracle relational database allowed for better post-processing analysis.Oracle PL/SQL was also used to implement the flight data correlation process.Oracle PL/SQL provides the procedural language support which SQL does not have.The Oracle database is also currently used as the ATM Sherlock Data Warehouse.ODS_CFD_LATEST_MSGS is the table that stores flight-state-per-Center records.The purpose of this table is to store the latest state of an associated nasaGufi flight from a Center.In order to maintain an optimal query and update performance on this table, completed flights and old records (e.g., over 24 hours old) can be purged periodically.The order of the columns in the unique key is designed to optimize queries of a given flightId from various Centers.Table 7 shows the table structure of ODS_CFD_LATEST_MSGS.For the prototype, there is a need to analyze the correlated messages.The Oracle relational database was also chosen to store the messages for the prototyping effort.ODS_CFD_MSGS is the table to store all the processed ERAM messages.All messages have two common fields as a result of the correlating process: NASA_MSG_ID and NASA_MSG_ID_SCORE.Not all messages are flight related.Among messages that are flight related, an extra two fields, NASA_GUFI and NASA_GUFI_SCORE, are set.There are multiple variants and versions of UUID.The prototype selected UUID Version 1 which is based on MAC address and date-time of the computer.Frequently queried fields from the messages are also explicitly saved as columns in the table.The text of the original message is saved in the column MSG_XML.ERAM messages are reported in the millions per day.In order to get better query performance of a subset of ERAM messages from a given time period, the table that stores processed ERAM messages is configured to store data in a compressed form, and the records are partitioned by the column MSG_RCV_DATE_TIME_UTC on an hourly basis.The unique key on the column NASA_MSG_ID is purposely not enforced because its unique value is generated.Having a unique key on this large table would negatively impact the record insert operation.
Handling of Callsign ChangesWhen a flight has a change of callsign, or when one of the aircraft is leaving from a formation flight, there is an IH message to record the event.In order to ensure that messages that have different but related flightId are processed in chronological order, the table ODS_CFD_IH_MSGS is used to store the handle of a given flightId.The handle always references the original flightId when there is a callsign change event.Whenever a flightId changes its callsign, a record is saved into ODS_CFD_IH_MSGS.Each subsequent callsign change would also result in a new record being saved into the table ODS_CFD_IH_MSGS while maintaining the same handle.Like the table ODS_CFD_LATEST_MSGS, in order to maintain an optimal query and update performance on this table, completed flights and old records (e.g., over 24 hours old) should be purged periodically.The order of the columns in the unique key is designed to optimize queries a given flightId from various Centers.
Parallel Processing of MessagesIt was observed that the rate of all ERAM messages reported from twenty Centers peaked around 1,800 messages per second on any given day.In order to process these messages at the peak rate, not only for offline processing but also potentially real-time processing, the prototype was configured to use ten concurrent threads.All flight-related messages are separated into ten groups based on their flightIds.Each flightId was assigned to a flightIdHandle value in case the flightId had a change in callsign earlier (see Section Handling of Callsign Changes).The text value of a flightIdHandle would be hashed to an integer called flightIdHandleCode ranging between 0 and 9.The flightIdHandleCode determined which one of the ten threads to which a message should be assigned and processed.The chronological order of the messages was not altered.All messages were processed in the order they were received at NASA.This is particularly important for evaluating the quality of track position messages.The quality of a track position message, stored as nasaMsgIdScore, is determined by the last known track-position.Using the ten concurrent threads proved that parallel processing increases the processing speed for correlating messages.24-hours of ERAM messages were processed in about three hours.When processed messages were stored into the Oracle relational database, the processing speed was about 2,000 messages per second.Because correlated messages may not necessarily need to be stored in a relational database, another test was performed to measure the average speed of correlating messages alone.Without storing the messages into the database, the speed was about 2,800 messages per second.Figure 1 shows the graphical flow of the parallel processing steps in the Pentaho Data Integration application.The correlated messages from the prototype were tested by using the scenarios described in Section 3.3.The test was performed by identifying flights that fall into those scenarios, reporting the correlated messages in chronological order per flight, and visualizing the track positions by using Google Earth.Figure 2 shows a three-dimensional image of track positions for a flight at a level altitude of 32,000 feet.Each track position and extruded vertical line in red is a position reported by a different Center.When positions are reported within a few seconds of each other, the trajectory has a seesaw pattern.When the nasaMsgIdScore >= 0.5 filter is applied to the track positions, those that don't align with the reported bearings are eliminated.The resulting trajectory, in blue, better reflects the actual position history of the flight.
ConclusionsAn efficient heuristic approach for correlating flight data from 20 ERAM Centers was developed, and a prototype was completed and tested.The approach was intended to resolve challenging scenarios such as a flight receiving multiple reports from different Centers within a few seconds, or the callsign of a flight changing while en route.All ERAM messages were processed, flight data were correlated, and all data were stored in a database.Each ERAM message and each flight are assigned with unique identifiers created by the application.Unlike the identifiers assigned by ERAM, the two unique identifiers assigned by the application, nasaMsgId for each message, and nasaGufi for each flight, do not have any time window constraint.This allows a much more efficient and correct analysis of all historical flight data in a data warehouse.For a flight-related message, the confidence in the assigned nasaGufi is expressed as a weighted score value, nasaGufiScore.For a flight position message, the quality of the track position is also expressed as a weighted score value, nasaMsgIdScore.Users of the correlated flight messages can apply a filter on nasaMsgIdScore of 0.5 or higher to select only non-conflicting track positions.The processing speed for correlating ERAM messages exceeds the receiving rate of messages.The prototype demonstrated that the approach is viable not only for offline processing but also real-time processing.5. 33Parallel Processing of Messages .................................................................................. 25 6 Conclusions ......................................................................................................................... 29 7 References ........................................................................................................................... 30 Appendix A: Sample ERAM Messages in XML Format .............................................................. 31 AH (Flight Amendment Information) ........................................................................................ 31 AI (Database Record Transfer Altimeter Status Information) .................................................. 33 BA (Beacon Code Reassignment Information) ........................................................................ 33 CK0 (Health Check) ................................................................................................................. 33 CL (Cancellation Information) .................................................................................................. 33 DH (Departure Information) ..................................................................................................... 34 ET (Expected Departure Time Information) ............................................................................. 34 FH (Flight Plan Information) .................................................................................................... 34 FPI (Database Record Transfer Flight Plan Information) ........................................................ 36 GH (General Information) ........................................................................................................ 38 HA (Altimeter Setting Information) ........................................................................................... 38 HF (FDB Fourth Line Information) ........................................................................................... 38 HH (Hold Information) .............................................................................................................. 38 HI (ERAM Status) .................................................................................................................... 39 HP (Position Update Information) ............................................................................................ 39 HR (Route Status Information) ................................................................................................ 39 HS (ERAM Status) ................................................................................................................... 39 HT (Point Out Information) ...................................................................................................... 40 HV (Flight Arrival Information) ................................................................................................. 40 HX (Converted Route Information) .......................................................................................... 40 HZ (ARTS TZ Information) ...................................................................................................... 40 IH (Aircraft ID Amend Information) .......................................................................................... 41 LH (Interim Altitude Information) .............................................................................................. 41 NL (Tentative Flight Plan Removal) ......................................................................................... 41 OH (Handoff Status) ................................................................................................................ 41 PH (Progress Report Information) ........................................................................................... 42 PT (Inbound Point Out Information) ......................................................................................... 42 RE (Beacon Code Restricted Information) .............................................................................. 42 RH (Drop Track Information) ................................................................................................... 42 RI (Database Record Transfer Route Status Information) ...................................................... 42 S1 (Database Record Transfer Sector Assignment Information) ............................................ 43 SH (Sector Assignment Status Information) ............................................................................ 46 SI (Database Record Transfer Sector Assignment Information) ............................................. 50 TH (Track Information) ............................................................................................................ 51 UB (Beacon Code Utilization Information) ............................................................................... 52
Figure 1 .Figure 2 .Figure 3 .123Figure 1.Paralleling processing of ERAM messages by using Pentaho Data Integration.......... 26 Figure 2. Duplicate track positions reported from multiple Centers............................................ 27 Figure 3. Multiple GUFIs to track the same flight within the Center ZNY.................................... 28
Figure 1 .1Figure 1.Paralleling processing of ERAM messages by using Pentaho Data Integration.
Figure 2 .2Figure 2. Duplicate track positions reported from multiple Centers.
Figure 3 .3Figure 3. Multiple GUFIs to track the same flight within the Center ZNY.
Table 1 .1Message types identified in the ERAM HADDS Application Interface NA02 format....... 7
Table 2 .2Fields to correlate flight related messages...................................................................... 9
Table 3 :3Fields for correlating a flight across multiple Centers................................................... 15
Table 4 .4Weighted Scores to Calculate Route Score.................................................................. 17
Table 5 .5Weighted Scores to Calculate Track Position Score ..................................................... 20
Table 6 .6Weighted Scores to Calculate Generic Score............................................................... 21
Table 7 .7Table structure of ODS_CFD_LATEST_MSGS. ........................................................... 22
Table 8 .8Table structure of ODS_CFD_MSGS........................................................................... 24
Table 9 .9Table structure of ODS_CFD_IH_MSGS...................................................................... 25
Table 1 .1Message types identified in the ERAM HADDS Application Interface NA02 format.1. The NA02 format specifications has a
Table 2 .2Fields to correlate flight related messages.msgTypemsgFacilitymsgRcvTimeEpochsourceId_00eflightId_02acomputerId_02dsspId_167abeaconCode_04aeramGufi_316atypeOfAircraft_03cREGIndicator_918dproposedDepartureTime_2431departureTime_243ncoordStatus_07d1coordTime_07d2flightPlanRoute_10adeparturePoint_26adestination_27agroundSpeed_05bassignedAlt_08a, orreportedAlt_54atrackPosition_23dtrackVelocity_23etimeOfTrackData_170aflightId_02a
Table 4 .4Weighted Scores to Calculate Route Score.WeightedConditionsScoreNote1. Flight Identifier Per CenterEn route flight may cross multiple CentersmsgFacility not match-1msgFacility, and64computerId_02d,and sspId_167a(when Center isERAM operational)matchOtherwise-15See scenario described in 3.3.62. Beacon CodeKey common identifier when crossing multiple Centerswhen ERAM is not operationalbeaconCode_04a32matchbeaconCode_04a is0not known in bothstate and messageOtherwise-13. ERAM GUFIOnly available when Center is ERAM operationaleramGufi_316a match16eramGufi_316a is not0known in both stateand messageOtherwise-14. Aircraft TypetypeOfAircraft_03c8matchtypeOfAircraft_03c is0not known in bothstate and messageOtherwise-995. Aircraft Tail NumberREGIndicator_918d4matchREGIndicator_918d is0not known in bothstate and messageotherwise-99
Table 5 .5Weighted Scores to Calculate Track Position ScoreWeightedConditionsScoreNote1. Flight Identifier Per Center and PositionNeed to work in the scenario that has trackpositions reporting from multiple CentersmsgFacility, computerId_02d, and5sspId_167a (when Center isERAM operational) matchmsgFacility match, but-99computerId_02d,and sspId_167a (when Center isERAM operational) do not matchmsgFacility do not match, andVariable Inverse distance (in meter) betweentimeOfTrackData_170a matchtrackPosition_23d in state and messageScore is normalized to range between 0.5and 1msgFacility do not match, andVariable Inverse of (distance (in meter) betweentimeOfTrackData_170a do nottrackPosition_23d in state and message,matchmultiplied by time gap betweentimeOfTrackData_170a in state andmessage)Score is normalized to range between 0 and0.49Otherwise-1
Table 6 .6Weighted Scores to Calculate Generic Score.WeightedConditionsScoreNote1. Flight Identifier Per CenterEn route flight may cross multipleCentersmsgFacility not match-1msgFacility, and computerId_02d,5and sspId_167a (when Center is ERAMoperational) matchOtherwise-992. Beacon CodebeaconCode_04a match1beaconCode_04a is not known in both0state and messageOtherwise-13. ERAM GUFIOnly available when Center isERAM operationaleramGufi_316a match1eramGufi_316a is not known in both state0and messageOtherwise-14. DeparturedeparturePoint_26a match1departurePoint_26a is not known in both0state and messageOtherwise-995. Arrivaldestination_27a match1destination_27a is not known in both state0and messageotherwise-99
Table 7 .7Table structure of ODS_CFD_LATEST_MSGS.Unique KeyColumn NameData TypeNullable?Column SequenceMSG_SOURCEVARCHAR2(30 BYTE) NoMSG_FACILITYVARCHAR2(30 BYTE) No2MSG_TYPEVARCHAR2(30 BYTE) NoMSG_RCV_EPOCHNUMBERNoMSG_RCV_DATE_TIME_UTC DATENo
Table 8 .8Table 8 shows the table structure of ODS_CFD_MSGS.Table structure of ODS_CFD_MSGS.Column NameData TypeNullable?MSG_RCV_DATE_TIME_UTC DATENoMSG_RCV_EPOCHNUMBERNoNASA_MSG_IDVARCHAR2(255 BYTE) NoNASA_MSG_ID_SCORENUMBERNoNASA_GUFIVARCHAR2(255 BYTE) YesNASA_GUFI_SCORENUMBERYesMSG_SOURCEVARCHAR2(30 BYTE) NoMSG_FACILITYVARCHAR2(30 BYTE) NoMSG_TYPEVARCHAR2(30 BYTE) NoSOURCE_DATE_TIME_UTC DATEYesSOURCE_SEQNUMBERYesFLIGHT_IDVARCHAR2(30 BYTE) YesCOMPUTER_IDVARCHAR2(30 BYTE) YesSITE_SPECIFIC_PLAN_IDNUMBER(38,0)YesBEACON_CODEVARCHAR2(30 BYTE) YesGUFIVARCHAR2(30 BYTE) YesAC_TYPEVARCHAR2(30 BYTE) YesICAO_REG_INDICATORVARCHAR2(255 BYTE) YesPPS_DEP_DATE_TIME_UTC DATEYesDEP_DATE_TIME_UTCDATEYesCOORD_STATUSVARCHAR2(30 BYTE) YesCOORD_DATE_TIME_UTCDATEYesFLIGHT_PLAN_ROUTEVARCHAR2(4000 BYTE) YesFLIGHT_PLAN_DEPVARCHAR2(30 BYTE) YesFLIGHT_PLAN_ARRVARCHAR2(30 BYTE) YesGROUND_SPEED_KTNUMBER(38,0)YesREPORTED_ALT_FTNUMBER(38,0)YesTRACK_LAT_DEGNUMBERYesTRACK_LON_DEGNUMBERYesTRACK_HEADING_DEGNUMBER(38,0)YesTRACK_DATE_TIME_UTCDATEYesMSG_XMLCLOBNo
Table 9 .9Table 9 shows the table structure of ODS_CFD_IH_MSGS.The column FLIGHT_ID_HANDLE stores the handle of the flightId from every IH message.Table structure of ODS_CFD_IH_MSGS.Unique KeyColumn NameData TypeNullable?Column SequenceMSG_SOURCEVARCHAR2(30 BYTE) No4MSG_FACILITYVARCHAR2(30 BYTE) No2MSG_RCV_EPOCHNUMBERNo3MSG_RCV_DATE_TIME_UTC DATENoSOURCE_DATE_TIME_UTC DATENoSOURCE_SEQNUMBERNoFLIGHT_IDVARCHAR2(30 BYTE) No1FLIGHT_ID_HANDLEVARCHAR2(30 BYTE) No
		
		

			
AH (Flight Amendment Information)<eramMsg facility="ZAB" msg_type="AH" rcv_time="1429567582. 999346"> <sourceId_00e>2151217630</sourceId_00e> <flightId_02a>FFT250</flightId_02a> <computerId_02d>817</computerId_02d> <sspId_167a>6</sspId_167a> <numberOfAircraft_03a/> <typeOfAircraft_03c>A319</typeOfAircraft_03c> <airborneEquip_03e>L</airborneEquip_03e> <beaconCode_04a>3446</beaconCode_04a> <externalBeaconCode_04b/> <trueAirSpeed_05a>442</trueAirSpeed_05a> <coordFix_06a>LAA202073</coordFix_06a> <coordStatus_07d1>E</coordStatus_07d1> <coordTime_07d2>2211</coordTime_07d2> <assignedAlt_08a>390</assignedAlt_08a> <requestedAlt_09/> <flightPlanRoute_10a>KDEN.SPAZZ3.TBE.J17.PNH..MQP.DRLLR4.KIAH/2332</flightPlanRoute_10a> <FPA_143a0<ICAO14thAdaptedField18_999n/> <ICAO15thAdaptedField18_999o/> <ICAO16thAdaptedField18_999p/> <ICAO17thAdaptedField18_999q/> <ICAO18thAdaptedField18_999r/> <ICAO19thAdaptedField18_999s/> <ICAO20thAdaptedField18_999t/> <ICAO21stAdaptedField18_999u/> <ICAO22ndAdaptedField18_999v/> <ICAO23rdAdaptedField18_999w/> <ICAO24thAdaptedField18_999x/> <ICAO25thAdaptedField18_999y/> <localIntendedRoute_10b/> <eramGufi_316a>KD76327200</eramGufi_316a> <ATCIntendedRoute_10c/> <flightPlanRouteRevisionNumber_148a/> </eramMsg> <typeOfAircraft_03c>CL30</typeOfAircraft_03c> <airborneEquip_03e>L</airborneEquip_03e> <beaconCode_04a/> <trueAirSpeed_05a>458</trueAirSpeed_05a> <coordFix_06a>KELP</coordFix_06a> <coordStatus_07d1>P</coordStatus_07d1> <coordTime_07d2>2345</coordTime_07d2> <departureTime_243n/> <proposedDepartureTime_2431>2345</proposedDepartureTime_2431> <estDepartureClearanceTime_2432/> <arrivalTime_28b/> <assignedAlt_08/> <requestedAlt_09a>410</requestedAlt_09a> <flightPlanRoute_10a> KELP..SUMMY..CME..TXO.J74.IRW.J98.SGF..DELMA.DELMA2.KCPS/0204 </flightPlanRoute_10a> <localIntendedRoute_10b> KELP.LATVE2.CME..TXO.J74.IRW.J98.SGF..DELMA.DELMA2.KCPS/0204 </localIntendedRoute_10b> <ETA_28a/> <remarks_11c/> <holdDataFix_21a/> <holdDataTime_21d/> <progressReportFix_18a/> <progressReportTime_18d/> <interimAlt_76b/> <AARNonFld10_142f/> <ADRFld10_142c>.LATVE2.CME</ADRFld10_142c> <ADARNonFld10_142b/> <AARId_141c/> <ADRId_141b>LATVE</ADRId_141b> <ADARId_141a/> <FPA_143a0/> <FPA_143a1/> <FPA_143a2/> <FPA_143a3/> <FAV_143b0/> <FAV_143b1/> <FAV_143b2/> <FAV_143b3/> <flightRules_908a>I</flightRules_908a> <typeOfFlight_908b>G</typeOfFlight_908b> <wakeTurbulenceCat_909c>M</wakeTurbulenceCat_909c> <comNavApproachEquip_910a/> <survEquip_910b/> <altAero_916c>KSTL</altAero_916c> <comNavApproachEquipICAO2012_910c>SBDE3FGHRWXYZ</comNavApproachEquipICAO2012_910c> <survEquipICAO2012_910d>SB1</survEquipICAO2012_910d> <NAVIndicator_918l>SBAS</NAVIndicator_918l> HT (Point Out Information) <eramMsg facility="ZAU" msg_type="HT" rcv_time="1429567621.419576"> <sourceId_00e>2152008973</sourceId_00e> <flightId_02a>DAL1897</flightId_02a> <computerId_02d>859</computerId_02d> <sspId_167a>450</sspId_167a> <sourceSectorRouting_134b>62</sourceSectorRouting_134b> <elementGroupCount_224h>1</elementGroupCount_224h> <targetSector_16g>27</targetSector_16g> </eramMsg> HV (Flight Arrival Information) <eramMsg facility="ZAB" msg_type="HV" rcv_time="1429567599.837874"> <sourceId_00e>2151357673</sourceId_00e> <flightId_02a>N622TR</flightId_02a> <computerId_02d>251</computerId_02d> <sspId_167a>559</sspId_167a> <departurePoint_26a>CCR</departurePoint_26a> <destination_27a>SDL</destination_27a> <arrivalTime_28b>A2151</arrivalTime_28b> </eramMsg> HX (Converted Route Information) <eramMsg facility="ZAB" msg_type="HX" rcv_time="1429567583.060284"> <sourceId_00e>2151217631</sourceId_00e> <flightId_02a>FFT250</flightId_02a> <computerId_02d>817</computerId_02d> <sspId_167a>6</sspId_167a> <elementGroupCount_224h>4</elementGroupCount_224h> <fixTime_68c>TBE/2210</fixTime_68c> <fixTime_68c>KENTO/2215</fixTime_68c> <fixTime_68c>PNH/2229</fixTime_68c> <fixTime_68c>MQP/2257</fixTime_68c> </eramMsg> HZ (ARTS TZ Information) <eramMsg facility="ZAB" msg_type="HZ" rcv_time="1429726468.701880"> <sourceId_00e>1759263253</sourceId_00e> <addresseeARTS_00d>A</addresseeARTS_00d> <addresserARTS_00a>LLL</addresserARTS_00a> <elementGroupCount_224h>1</elementGroupCount_224h> <hzTrack> <flightId_02a>N247MD</flightId_02a> <computerId_02d>225</computerId_02d> <groundSpeed_05b>191</groundSpeed_05b> <assignedAlt_08a>062</assignedAlt_08a> <trackPosition_23d>334905N/1124712W</trackPosition_23d> </hzTrack> </eramMsg>
			

			
A flight-state-per-Center record is comprised of the fields listed in Table 3.The unique key to a flight-state-per-Center is a combination of four fields, namely, flightId_02a, msgFacility, computerId_02d, and nasaGufi.nasaGufi is a unique identifier for a flight; it is determined by the correlation process, and its uniqueness does not have a time period limit.All flight-state-per-
Appendix A: Sample ERAM Messages in XML FormatThe following sample ERAM messages from each message type are sourced from the binary stream NA02 format.In order to make the ERAM messages be more accessible without using a custom reader, the messages are reformatted in XML.In this custom ERAM XML format, the element names closely resemble those of the "Simple Schema" from SFDPS.
FPI (Database Record Transfer Flight Plan Information)<eramMsg facility="ZAB" msg_type="FPI" rcv_time="			
			

				


	
		Architecture and capabilities of a data warehouse for ATM research
		
			MichelleEshow
		
		
			MaxLui
		
		
			ShubhaRanjan
		
		10.1109/dasc.2014.6979560
	
	
		2014 IEEE/AIAA 33rd Digital Avionics Systems Conference (DASC)
		Colorado Springs, CO
		
			IEEE
			October 5-9, 2014
		
	
	M. Eshow, M. Lui and S. Ranjan, "Architecture and Capabilities of a Data Warehouse for ATM Research," in 33rd Digital Avionics Systems Conference, Colorado Springs, CO, October 5-9, 2014.



	
		Universally Unique Identifier
		10.32388/va0ly6
		
	
	
		Refer to
		
			Qeios
			
		
	
	Refer to http://en.wikipedia.org/wiki/Universally_unique_identifier.



	
		U.S. International Air Travel Statistics. Volpe National Transportation Systems Center. Center for Transportation Information, DTS-44, Kendall Square, Cambridge, MA 02142
		
			AJohn
		
		10.1177/004728759303100425
	
	
		Journal of Travel Research
		Journal of Travel Research
		0047-2875
		1552-6763
		
			31
			4
			
			
			SAGE Publications
		
	
	Air Traffic Management Systems Division
	John A. Volpe National Transportation Systems Center (Volpe Center) Air Traffic Management Systems Division, "SWIM Flight Data Publication Service Reference Manual," 55



	
		
		
			Broadway Cambridge
		
		
			Ma 02142
		
		
			December 16, 2004
		
	
	Broadway Cambridge, MA 02142, December 16, 2004.



	
		Pentaho Data Integration
		
			StefanMüller
		
		
			ChristopherKeller
		
		10.3139/9783446441255.005
		
	
	
		Pentaho und Jedox
		
			Carl Hanser Verlag GmbH & Co. KG
			
			
		
	
	Refer to http://community.pentaho.com/projects/data-integration/.


				
			
		
	
